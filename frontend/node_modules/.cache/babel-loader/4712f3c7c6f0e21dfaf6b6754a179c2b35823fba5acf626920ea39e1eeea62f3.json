{"ast":null,"code":"import React from'react';import{Grid,Typography,Box,Chip,Avatar,LinearProgress,CircularProgress}from'@mui/material';import{SportsFootball,EmojiEvents,TrendingUp,Schedule}from'@mui/icons-material';import{motion}from'framer-motion';import{useQuery}from'@tanstack/react-query';import{format}from'date-fns';import GlassCard from'../components/ui/GlassCard';import GradientButton from'../components/ui/GradientButton';import{gameApi,standingApi,conferenceChampionshipApi}from'../services/api';import{useAuth}from'../hooks/useAuth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Dashboard=()=>{var _standings$data,_championshipBid$data,_championshipBid$data2,_championshipBid$data3,_championshipBid$data4,_championshipBid$data5;const{selectedTeam,user}=useAuth();// API Queries - now using the selected team\nconst{data:recentGamesData,isLoading:recentGamesLoading}=useQuery({queryKey:['games','recent',selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id],queryFn:async()=>{if(!selectedTeam)return{data:[]};return gameApi.getByTeam(selectedTeam.id);},enabled:!!selectedTeam});const{data:upcomingGamesData,isLoading:upcomingGamesLoading}=useQuery({queryKey:['games','upcoming',selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id],queryFn:async()=>{if(!selectedTeam)return{data:[]};return gameApi.getUpcoming(selectedTeam.id);},enabled:!!selectedTeam});const{data:standings,isLoading:standingsLoading}=useQuery({queryKey:['standings',new Date().getFullYear()],queryFn:()=>standingApi.getByYear(new Date().getFullYear())});const{data:championshipBid,isLoading:championshipLoading}=useQuery({queryKey:['championship-bid',selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id,new Date().getFullYear()],queryFn:async()=>{if(!selectedTeam)return null;return conferenceChampionshipApi.getChampionshipBid(selectedTeam.id,new Date().getFullYear());},enabled:!!selectedTeam});const containerVariants={initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:0.1}}};const itemVariants={initial:{y:20,opacity:0},animate:{y:0,opacity:1,transition:{type:'spring',stiffness:300,damping:24}}};// Calculate stats from API data using selected team\nconst userStanding=standings===null||standings===void 0?void 0:(_standings$data=standings.data)===null||_standings$data===void 0?void 0:_standings$data.find(s=>s.teamId===(selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id));const nextGame=((upcomingGamesData===null||upcomingGamesData===void 0?void 0:upcomingGamesData.data)||[])[0];const statCards=[{title:'Conference Rank',value:championshipBid!==null&&championshipBid!==void 0&&(_championshipBid$data=championshipBid.data)!==null&&_championshipBid$data!==void 0&&_championshipBid$data.currentRank?\"#\".concat(championshipBid.data.currentRank):'--',icon:TrendingUp,color:'#4caf50',gradient:'success',subtitle:\"\".concat((selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.conference)||'',\" Standing\")},{title:'Conference Record',value:championshipBid!==null&&championshipBid!==void 0&&championshipBid.data?\"\".concat(championshipBid.data.conferenceWins,\"-\").concat(championshipBid.data.conferenceLosses):'--',icon:SportsFootball,color:'#1e88e5',gradient:'primary',subtitle:'Conference Games'},{title:'Championship Bid',value:championshipBid!==null&&championshipBid!==void 0&&(_championshipBid$data2=championshipBid.data)!==null&&_championshipBid$data2!==void 0&&_championshipBid$data2.canStillWinConference?'Alive':'Eliminated',icon:EmojiEvents,color:championshipBid!==null&&championshipBid!==void 0&&(_championshipBid$data3=championshipBid.data)!==null&&_championshipBid$data3!==void 0&&_championshipBid$data3.canStillWinConference?'#4caf50':'#f44336',gradient:championshipBid!==null&&championshipBid!==void 0&&(_championshipBid$data4=championshipBid.data)!==null&&_championshipBid$data4!==void 0&&_championshipBid$data4.canStillWinConference?'success':'error',subtitle:championshipBid!==null&&championshipBid!==void 0&&(_championshipBid$data5=championshipBid.data)!==null&&_championshipBid$data5!==void 0&&_championshipBid$data5.canStillWinConference?'Still in contention':'Out of race'},{title:'Next Game',value:nextGame?'Scheduled':'TBD',icon:Schedule,color:'#26a69a',gradient:'secondary',subtitle:nextGame?\"vs \".concat(nextGame.awayTeamName||nextGame.homeTeamName):'No upcoming games'}];// Process recent games data\nconst recentGames=((recentGamesData===null||recentGamesData===void 0?void 0:recentGamesData.data)||[]).slice(0,4).map(game=>{const isHome=game.homeTeamId===(selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id);const opponent=isHome?game.awayTeamName:game.homeTeamName;const userScore=isHome?game.homeScore:game.awayScore;const opponentScore=isHome?game.awayScore:game.homeScore;let result='T';if(userScore>opponentScore)result='W';else if(userScore<opponentScore)result='L';return{opponent:opponent||'Unknown',score:\"\".concat(userScore,\"-\").concat(opponentScore),result,date:game.date?format(new Date(game.date),'MMM d'):'TBD'};}).filter(Boolean);// Process upcoming games data\nconst upcomingGames=((upcomingGamesData===null||upcomingGamesData===void 0?void 0:upcomingGamesData.data)||[]).slice(0,2).map(game=>{const isHome=game.homeTeamId===(selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.id);const opponent=isHome?game.awayTeamName:game.homeTeamName;const opponentRank=isHome?game.awayTeamRank:game.homeTeamRank;return{opponent:opponent||'Unknown',date:game.date?format(new Date(game.date),'MMM d'):'TBD',time:game.date?format(new Date(game.date),'h:mm a'):'TBD',rank:opponentRank?\"#\".concat(opponentRank):'NR'};}).filter(Boolean);// Calculate season progress metrics\nconst totalGames=userStanding?userStanding.totalGames:0;const bowlEligible=((userStanding===null||userStanding===void 0?void 0:userStanding.wins)||0)>=6;const winPercentage=(userStanding===null||userStanding===void 0?void 0:userStanding.winPercentage)||0;const currentRank=(userStanding===null||userStanding===void 0?void 0:userStanding.rank)||0;// Conference championship progress based on championship bid\nconst championshipProgress=championshipBid!==null&&championshipBid!==void 0&&championshipBid.data?{gamesNeeded:championshipBid.data.gamesNeededToClinch,remainingGames:championshipBid.data.remainingGames,canWin:championshipBid.data.canStillWinConference,conferenceWinPct:championshipBid.data.conferenceWinPercentage,rank:championshipBid.data.currentRank,analysis:championshipBid.data.analysis}:null;return/*#__PURE__*/_jsxs(motion.div,{variants:containerVariants,initial:\"initial\",animate:\"animate\",children:[/*#__PURE__*/_jsx(Box,{sx:{mb:4},children:/*#__PURE__*/_jsxs(motion.div,{variants:itemVariants,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h3\",sx:{fontWeight:700,mb:1,background:'linear-gradient(135deg, #42a5f5, #66bb6a)',backgroundClip:'text',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',pt:7},children:\"Dashboard\"}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.secondary\",children:\"Welcome back, Coach! Here's your team overview.\"})]})}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[standingsLoading||championshipLoading?Array.from({length:4}).map((_,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,lg:3,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{gradient:true,children:/*#__PURE__*/_jsx(Box,{sx:{p:3,display:'flex',justifyContent:'center',alignItems:'center',height:120},children:/*#__PURE__*/_jsx(CircularProgress,{})})})})},index)):statCards.map((stat,index)=>/*#__PURE__*/_jsx(Grid,{item:true,xs:12,sm:6,lg:3,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{gradient:true,children:/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:2},children:[/*#__PURE__*/_jsx(Avatar,{sx:{background:\"linear-gradient(135deg, \".concat(stat.color,\"22, \").concat(stat.color,\"44)\"),color:stat.color,mr:2},children:/*#__PURE__*/_jsx(stat.icon,{})}),/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",sx:{fontWeight:700},children:stat.value}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:stat.subtitle})]})]}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",color:\"text.primary\",children:stat.title})]})})})},stat.title)),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,lg:6,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{children:/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{mb:3,fontWeight:600},children:\"Recent Games\"}),recentGamesLoading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',py:4},children:/*#__PURE__*/_jsx(CircularProgress,{})}):recentGames.length===0?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{textAlign:'center',py:4},children:\"No recent games found\"}):recentGames.map((game,index)=>/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',justifyContent:'space-between',py:2,borderBottom:index<recentGames.length-1?'1px solid rgba(255,255,255,0.1)':'none'},children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(Chip,{label:game.result,size:\"small\",sx:{background:game.result==='W'?'linear-gradient(135deg, #4caf50, #66bb6a)':'linear-gradient(135deg, #f44336, #e57373)',color:'white',fontWeight:600,mr:2}}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",sx:{fontWeight:600},children:[\"vs \",game.opponent]})]}),/*#__PURE__*/_jsxs(Box,{sx:{textAlign:'right'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{fontWeight:600},children:game.score}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:game.date})]})]},index))]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,lg:6,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{children:/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{mb:3,fontWeight:600},children:\"Upcoming Games\"}),upcomingGamesLoading?/*#__PURE__*/_jsx(Box,{sx:{display:'flex',justifyContent:'center',py:4},children:/*#__PURE__*/_jsx(CircularProgress,{})}):upcomingGames.length===0?/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{textAlign:'center',py:4},children:\"No upcoming games scheduled\"}):upcomingGames.map((game,index)=>/*#__PURE__*/_jsx(Box,{sx:{p:2,mb:index<upcomingGames.length-1?2:0,background:'linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05))',borderRadius:'12px',border:'1px solid rgba(255,255,255,0.1)'},children:/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',justifyContent:'space-between'},children:[/*#__PURE__*/_jsxs(Box,{children:[/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',mb:1},children:[/*#__PURE__*/_jsxs(Typography,{variant:\"h6\",sx:{fontWeight:600,mr:1},children:[\"vs \",game.opponent]}),/*#__PURE__*/_jsx(Chip,{label:game.rank,size:\"small\",sx:{background:'linear-gradient(135deg, #ff9800, #ffb74d)',color:'white',fontWeight:600}})]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",children:[game.date,\" \\u2022 \",game.time]})]}),/*#__PURE__*/_jsx(GradientButton,{size:\"small\",children:\"View Details\"})]})},index))]})})})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{children:/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{mb:3,fontWeight:600},children:\"Season Progress\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mb:1},children:\"Conference Championship\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:championshipProgress!==null&&championshipProgress!==void 0&&championshipProgress.canWin?championshipProgress.remainingGames>0&&championshipProgress.gamesNeeded>0?Math.max(10,100-championshipProgress.gamesNeeded/championshipProgress.remainingGames*100):championshipProgress.rank===1?100:50:0,sx:{height:8,borderRadius:4,background:'rgba(255,255,255,0.1)','& .MuiLinearProgress-bar':{background:championshipProgress!==null&&championshipProgress!==void 0&&championshipProgress.canWin?'linear-gradient(90deg, #4caf50, #66bb6a)':'linear-gradient(90deg, #f44336, #e57373)',borderRadius:4}}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mt:1},children:championshipProgress!==null&&championshipProgress!==void 0&&championshipProgress.canWin?championshipProgress.rank===1?'Leading conference':\"Need \".concat(championshipProgress.gamesNeeded,\" more wins\"):'Eliminated from title race'})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mb:1},children:\"Bowl Eligibility\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:bowlEligible?100:((userStanding===null||userStanding===void 0?void 0:userStanding.wins)||0)/6*100,sx:{height:8,borderRadius:4,background:'rgba(255,255,255,0.1)','& .MuiLinearProgress-bar':{background:bowlEligible?'linear-gradient(90deg, #4caf50, #66bb6a)':'linear-gradient(90deg, #ff9800, #ffb74d)',borderRadius:4}}}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mt:1},children:bowlEligible?'Qualified':\"\".concat((userStanding===null||userStanding===void 0?void 0:userStanding.wins)||0,\"/6 wins\")})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Box,{sx:{mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mb:1},children:\"Win Percentage\"}),/*#__PURE__*/_jsx(LinearProgress,{variant:\"determinate\",value:winPercentage*100,sx:{height:8,borderRadius:4,background:'rgba(255,255,255,0.1)','& .MuiLinearProgress-bar':{background:winPercentage>=0.75?'linear-gradient(90deg, #4caf50, #66bb6a)':winPercentage>=0.5?'linear-gradient(90deg, #ff9800, #ffb74d)':'linear-gradient(90deg, #f44336, #e57373)',borderRadius:4}}}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",color:\"text.secondary\",sx:{mt:1},children:[(winPercentage*100).toFixed(1),\"% this season\"]})]})})]})]})})})}),championshipProgress&&/*#__PURE__*/_jsx(Grid,{item:true,xs:12,children:/*#__PURE__*/_jsx(motion.div,{variants:itemVariants,children:/*#__PURE__*/_jsx(GlassCard,{children:/*#__PURE__*/_jsxs(Box,{sx:{p:3},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h5\",sx:{mb:3,fontWeight:600},children:\"Conference Championship Analysis\"}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:3,children:[/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:8,children:/*#__PURE__*/_jsxs(Box,{sx:{p:3,background:'linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05))',borderRadius:'12px',border:'1px solid rgba(255,255,255,0.1)',mb:2},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{mb:2,fontWeight:600},children:\"Current Situation\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body1\",sx:{mb:2},children:championshipProgress.analysis}),/*#__PURE__*/_jsxs(Box,{sx:{display:'flex',alignItems:'center',gap:2,flexWrap:'wrap'},children:[/*#__PURE__*/_jsx(Chip,{label:\"#\".concat(championshipProgress.rank,\" in \").concat(selectedTeam===null||selectedTeam===void 0?void 0:selectedTeam.conference),sx:{background:'linear-gradient(135deg, #1e88e5, #42a5f5)',color:'white',fontWeight:600}}),/*#__PURE__*/_jsx(Chip,{label:\"\".concat((championshipProgress.conferenceWinPct*100).toFixed(1),\"% conf. win rate\"),sx:{background:'linear-gradient(135deg, #4caf50, #66bb6a)',color:'white',fontWeight:600}}),championshipProgress.canWin&&championshipProgress.gamesNeeded>0&&/*#__PURE__*/_jsx(Chip,{label:\"\".concat(championshipProgress.gamesNeeded,\" wins needed\"),sx:{background:'linear-gradient(135deg, #ff9800, #ffb74d)',color:'white',fontWeight:600}})]})]})}),/*#__PURE__*/_jsx(Grid,{item:true,xs:12,md:4,children:/*#__PURE__*/_jsxs(Box,{sx:{p:3,background:championshipProgress.canWin?'linear-gradient(135deg, rgba(76, 175, 80, 0.1), rgba(76, 175, 80, 0.05))':'linear-gradient(135deg, rgba(244, 67, 54, 0.1), rgba(244, 67, 54, 0.05))',borderRadius:'12px',border:\"1px solid \".concat(championshipProgress.canWin?'rgba(76, 175, 80, 0.3)':'rgba(244, 67, 54, 0.3)'),textAlign:'center',height:'100%',display:'flex',flexDirection:'column',justifyContent:'center'},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h3\",sx:{fontWeight:700,mb:1,color:championshipProgress.canWin?'#4caf50':'#f44336'},children:championshipProgress.canWin?'✓':'✗'}),/*#__PURE__*/_jsx(Typography,{variant:\"h6\",sx:{fontWeight:600,mb:1},children:\"Championship Bid\"}),/*#__PURE__*/_jsx(Typography,{variant:\"body2\",color:\"text.secondary\",children:championshipProgress.canWin?'Still in contention':'Mathematically eliminated'})]})})]})]})})})})]})]});};export default Dashboard;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}